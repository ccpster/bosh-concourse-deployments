---
name: bosh

releases:
  - name: bosh
    url: file://assets/bosh.tgz
  - name: bosh-google-cpi
    url: file://assets/cpi.tgz

resource_pools:
  - name: vms
    network: private
    stemcell:
      url: file://assets/stemcell.tgz
    cloud_properties:
      zone: ((gce_zone))
      machine_type: g1-small
      root_disk_size_gb: 40
      root_disk_type: pd-standard
      tags:
        - ((bosh_director_tag))
      service_scopes:
        - compute
        - devstorage.full_control

disk_pools:
  - name: disks
    disk_size: 20_000
    cloud_properties:
      type: pd-standard

networks:
  - name: public
    type: vip
  - name: private
    type: manual
    subnets:
    - range: ((director_cidr))
      gateway: ((director_gateway))
      static: [((director_private_ip))]
      cloud_properties:
        network_name: ((network_name))
        subnetwork_name: ((subnetwork_name))
        tags:
          - ((bosh_internal_tag))

jobs:
  - name: bosh
    instances: 1

    templates:
      - name: nats
        release: bosh
      - name: postgres
        release: bosh
      - name: blobstore
        release: bosh
      - name: director
        release: bosh
      - name: health_monitor
        release: bosh
      - name: google_cpi
        release: bosh-google-cpi

    resource_pool: vms
    persistent_disk_pool: disks

    networks:
      - name: private
        static_ips: [((director_private_ip))]
        default:
          - dns
          - gateway
      - name: public
        static_ips: [((director_public_ip))]

    properties:
      nats:
        address: 127.0.0.1
        user: nats
        password: ((nats_password))

      postgres: &db
        listen_address: 127.0.0.1
        host: 127.0.0.1
        user: postgres
        password: ((postgres_password))
        database: bosh
        adapter: postgres

      blobstore:
        address: ((director_private_ip))
        port: 25250
        provider: dav
        director:
          user: director
          password: ((blobstore_director_password))
        agent:
          user: agent
          password: ((blobstore_agent_password))

      director:
        address: 127.0.0.1
        name: director-gce
        db: *db
        cpi_job: google_cpi
        user_management:
          provider: local
          local:
            users:
              - name: ((director_admin_user))
                password: ((director_admin_password))
              - name: hm
                password: ((director_hm_password))
        ssl:
          cert: ((ssl_cert))
          key: ((ssl_key))
      hm:
        director_account:
          user: hm
          password: ((director_hm_password))
        resurrector_enabled: true

      google: &google_properties
        project: ((google_project_id))
        json_key: ((google_credentials_json))

      agent:
        mbus: "nats://nats:((nats_password))@((director_private_ip)):4222"

      ntp: &ntp
        - 169.254.169.254

cloud_provider:
  template:
    name: google_cpi
    release: bosh-google-cpi

  mbus: "https://mbus:((mbus_password))@((director_public_ip)):6868"

  properties:
    google: *google_properties
    agent:
      mbus: https://mbus:((mbus_password))@0.0.0.0:6868
    blobstore: {provider: local, path: /var/vcap/micro_bosh/data/cache}
    ntp: *ntp
